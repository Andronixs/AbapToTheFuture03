sap.ui.controller("monstermonitor.Monsters", {                                                                                                                                                                                                                 
  /**                                                                                                                                                                                                                                                          
   * Called when a controller is instantiated and its View controls (if                                                                                                                                                                                        
   * available) are already created. Can be used to modify the View before it                                                                                                                                                                                  
   * is displayed, to bind event handlers and do other one-time                                                                                                                                                                                                
   * initialization.                                                                                                                                                                                                                                           
   *&nbsp;                                                                                                                                                                                                                                                     
   * @memberOf monstermonitor.MonsterMonitor                                                                                                                                                                                                                   
   */                                                                                                                                                                                                                                                          
  onInit : function() {                                                                                                                                                                                                                                        
    var oModel = new sap.ui.model.odata.ODataModel(this                                                                                                                                                                                                        
        .getUrl("/sap/opu/odata/sap/Z_MONSTER_SRV/"), true);                                                                                                                                                                                                   
    this.getView().setModel(oModel);                                                                                                                                                                                                                           
    jQuery.sap.require("sap.ui.core.ws.WebSocket");                                                                                                                                                                                                            
    this.oWs = new sap.ui.core.ws.WebSocket('/sap/bc/apc/sap/zapc_for_monsters')                                                                                                                                                                               
  },                                                                                                                                                                                                                                                           
  /**                                                                                                                                                                                                                                                          
   * Similar to onAfterRendering, but this hook is invoked before the                                                                                                                                                                                          
   * controller's View is re-rendered (NOT before the first rendering!                                                                                                                                                                                         
   * onInit() is used for that one!).                                                                                                                                                                                                                          
   *&nbsp;                                                                                                                                                                                                                                                     
   * @memberOf monstermonitor.MonsterMonitor                                                                                                                                                                                                                   
   */                                                                                                                                                                                                                                                          
  // onBeforeRendering: function() {                                                                                                                                                                                                                           
  //                                                                                                                                                                                                                                                           
  // },                                                                                                                                                                                                                                                        
  /**                                                                                                                                                                                                                                                          
   * Called when the View has been rendered (so its HTML is part of the                                                                                                                                                                                        
   * document). Post-rendering manipulations of the HTML could be done here.                                                                                                                                                                                   
   * This hook is the same one that SAPUI5 controls get after being rendered.                                                                                                                                                                                  
   *&nbsp;                                                                                                                                                                                                                                                     
   * @memberOf monstermonitor.MonsterMonitor                                                                                                                                                                                                                   
   */                                                                                                                                                                                                                                                          
  // onAfterRendering: function() {                                                                                                                                                                                                                            
  //                                                                                                                                                                                                                                                           
  // },                                                                                                                                                                                                                                                        
  /**                                                                                                                                                                                                                                                          
   * Called when the Controller is destroyed. Use this one to free resources                                                                                                                                                                                   
   * and finalize activities.                                                                                                                                                                                                                                  
   *&nbsp;                                                                                                                                                                                                                                                     
   * @memberOf monstermonitor.MonsterMonitor                                                                                                                                                                                                                   
   */                                                                                                                                                                                                                                                          
  // onExit: function() {                                                                                                                                                                                                                                      
  //                                                                                                                                                                                                                                                           
  // }                                                                                                                                                                                                                                                         
  // Searching for Monster based on what the user puts in the Search Box                                                                                                                                                                                       
  onSearch : function(oEvent) {                                                                                                                                                                                                                                
    // add filter for search                                                                                                                                                                                                                                   
    var aFilters = [];                                                                                                                                                                                                                                         
    var sQuery = oEvent.getSource().getValue();                                                                                                                                                                                                                
    if (sQuery && sQuery.length > 0) {                                                                                                                                                                                                                         
      var filter = new sap.ui.model.Filter("Name",                                                                                                                                                                                                             
          sap.ui.model.FilterOperator.Contains, sQuery);                                                                                                                                                                                                       
      aFilters.push(filter);                                                                                                                                                                                                                                   
    }                                                                                                                                                                                                                                                          
    // update list binding                                                                                                                                                                                                                                     
    var oTable = this.getView().byId("idMonstersTable");                                                                                                                                                                                                       
    var binding = oTable.getBinding("items");                                                                                                                                                                                                                  
    binding.filter(aFilters, "Application");                                                                                                                                                                                                                   
  },                                                                                                                                                                                                                                                           
  // Call up the Monster Detail Dialog Box when Monster Selected                                                                                                                                                                                               
  onMonsterSelected : function(oEvent) {                                                                                                                                                                                                                       
    console.log('onMonsterSelected '                                                                                                                                                                                                                           
        + oEvent.getSource().getBindingContextPath());                                                                                                                                                                                                         
    if (this._monsterDetailDialog === undefined) {                                                                                                                                                                                                             
      this._monsterDetailDialog = new sap.ui.xmlfragment(                                                                                                                                                                                                      
          "monstermonitor.MonsterDetail", this);                                                                                                                                                                                                               
      this._monsterDetailDialog.setModel(this.getView().getModel());                                                                                                                                                                                           
    }                                                                                                                                                                                                                                                          
    this._monsterDetailDialog.open();                                                                                                                                                                                                                          
    this._monsterDetailDialog.bindElement({                                                                                                                                                                                                                    
      path : oEvent.getSource().getBindingContextPath(),                                                                                                                                                                                                       
      parameters : {                                                                                                                                                                                                                                           
        expand : 'MonsterItems'                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
    });                                                                                                                                                                                                                                                        
  },                                                                                                                                                                                                                                                           
  // Close the Monster Dialog Box when CLOSE button chosen                                                                                                                                                                                                     
  onMonsterDetailDialogCancel : function(oEvent) {                                                                                                                                                                                                             
    this._monsterDetailDialog.close();                                                                                                                                                                                                                         
  },                                                                                                                                                                                                                                                           
  // Deleting a Monster                                                                                                                                                                                                                                        
  onMonsterDelete : function(oEvent) {                                                                                                                                                                                                                         
    var oModel = this.getView().getModel();                                                                                                                                                                                                                    
    var oPath = oEvent.getSource().getBindingContext().getPath();                                                                                                                                                                                              
    oModel.remove(oPath, {                                                                                                                                                                                                                                     
      sucess : this._monsterDeleteSuccess,                                                                                                                                                                                                                     
      error : this._monsterDeleteError                                                                                                                                                                                                                         
    });                                                                                                                                                                                                                                                        
  },                                                                                                                                                                                                                                                           
  _monsterDeleteSuccess : function(oEvent) {                                                                                                                                                                                                                   
    this.onMonsterDetailDialogCancel();                                                                                                                                                                                                                        
    sap.m.MessageToast.show('Deleted', {                                                                                                                                                                                                                       
      duration : 5000,                                                                                                                                                                                                                                         
      my : 'center center',                                                                                                                                                                                                                                    
      at : 'center center'                                                                                                                                                                                                                                     
    });                                                                                                                                                                                                                                                        
  },                                                                                                                                                                                                                                                           
  _monsterDeleteError : function(oEvent) {                                                                                                                                                                                                                     
    var oResponse = JSON.parse(oEvent.response.body);                                                                                                                                                                                                          
    if (oResponse.error.message) {                                                                                                                                                                                                                             
      sap.m.MessageBox.alert(oResponse.error.message.value);                                                                                                                                                                                                   
    } else {                                                                                                                                                                                                                                                   
      sap.m.MessageBox.alert('An Unknown Error Detected');                                                                                                                                                                                                     
    }                                                                                                                                                                                                                                                          
  },                                                                                                                                                                                                                                                           
  // Get the URL to contact the SAP System                                                                                                                                                                                                                     
  getUrl : function(sUrl) {                                                                                                                                                                                                                                    
    if (sUrl == "")                                                                                                                                                                                                                                            
      return sUrl;                                                                                                                                                                                                                                             
    if (window.location.hostname == "localhost") {                                                                                                                                                                                                             
      return "proxy" + sUrl;                                                                                                                                                                                                                                   
    } else {                                                                                                                                                                                                                                                   
      return sUrl;                                                                                                                                                                                                                                             
    }                                                                                                                                                                                                                                                          
  },                                                                                                                                                                                                                                                           
  // Handle Action Sheet Button Being Pressed                                                                                                                                                                                                                  
  handleOpen : function (oEvent) {                                                                                                                                                                                                                             
        var oButton = oEvent.getSource();                                                                                                                                                                                                                      
        // create action sheet only once                                                                                                                                                                                                                       
        if (!this._actionSheet) {                                                                                                                                                                                                                              
          this._actionSheet = sap.ui.xmlfragment(                                                                                                                                                                                                              
            "monstermonitor.ActionSheet", this);                                                                                                                                                                                                               
          this.getView().addDependent(this._actionSheet);                                                                                                                                                                                                      
        }                                                                                                                                                                                                                                                      
        this._actionSheet.openBy(oButton);                                                                                                                                                                                                                     
      },                                                                                                                                                                                                                                                       
// Handle Monster Rampage Button Being Pressed                                                                                                                                                                                                                 
onMonsterRampage : function(oEvent) {                                                                                                                                                                                                                          
    this.oWs.send("0000000003;Horrible Monster")                                                                                                                                                                                                               
  },                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            